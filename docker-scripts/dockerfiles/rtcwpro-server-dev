FROM ubuntu:22.04

ENV DEBIAN_FRONTEND noninteractive
RUN dpkg --add-architecture i386 && \
    apt-get update && \
    apt-get -y upgrade && \
    apt-get install -y wget libc6:i386 unzip bbe git gdb-multiarch gcc

RUN useradd -ms /bin/bash game

USER game
WORKDIR /home/game

COPY --chown=game:game --from="rtcwpro/rtcw-base:1.0" /output/ /home/game

RUN mkdir /home/game/dev && \
    mkdir /home/game/rtcwpro && \
    ln -sf /home/game/dev/wolfded.x86 /home/game/wolfded.x86 && \
    ln -sf /home/game/dev/rtcwpro/ /home/game/rtcwpro/

RUN git clone --depth 1 "https://github.com/msh100/rtcw-config.git" \
    /home/game/settings/

COPY --chown=game:game scripts/entrypoint.sh /home/game/start
RUN chmod +x /home/game/start

EXPOSE 27960/udp

ENTRYPOINT ["/home/game/start"]
